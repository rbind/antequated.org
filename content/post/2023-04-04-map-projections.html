<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.649">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="">
<meta name="dcterms.date" content="2023-04-04">

<title>Map Projections and Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="2023-04-04-map-projections_files/libs/clipboard/clipboard.min.js"></script>
<script src="2023-04-04-map-projections_files/libs/quarto-html/quarto.js"></script>
<script src="2023-04-04-map-projections_files/libs/quarto-html/popper.min.js"></script>
<script src="2023-04-04-map-projections_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="2023-04-04-map-projections_files/libs/quarto-html/anchor.min.js"></script>
<link href="2023-04-04-map-projections_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="2023-04-04-map-projections_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="2023-04-04-map-projections_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="2023-04-04-map-projections_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="2023-04-04-map-projections_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Map Projections and Data</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 4, 2023</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="map-projections" class="level2">
<h2 class="anchored" data-anchor-id="map-projections">Map projections</h2>
<p>Map projections are literally a choice between compromises when mapping the (sphere, ellipsoid, geoid) to the plane, compromises of area, distance, conformality (preservation of angles,shape).</p>
<section id="tools" class="level4">
<h4 class="anchored" data-anchor-id="tools">Tools</h4>
<p>There are three main types of tools</p>
<ul>
<li>reprojecting points from <em>source</em> to <em>target</em> (old mode was <em>project</em> vs *inverse)</li>
<li>reprojecting vector objects (classed objects store their <em>source</em>, points, multipoints, lines, polygons)</li>
<li>reproject rasters, normally called <em>warping</em></li>
</ul>
<p>Reproject points/vectors <em>to the raster</em> for efficiency. But warping is now so accessible and efficient it is used widely, very useful for standardizing low level data streams, and interactive visualization.</p>
<p>There’s a wider remit of <em>regridding</em> with complex coordinate arrays, but also there are interpretations of rasters that aren’t really curvilinear, and there are storage modes (tabular XYZ) that are problematic for size and fidelity that complicate the conversations.</p>
</section>
<section id="many-data-sets-use-a-projection-natively." class="level3">
<h3 class="anchored" data-anchor-id="many-data-sets-use-a-projection-natively.">Many data sets use a projection natively.</h3>
<p>Sea ice comes in polar stereographic.</p>
<p>Many polar datasets use Lambert Azimuthal Equal Area</p>
<p>Some complex models are a regular grid in a projection (waom2 ROMS for example), but are delivered with <em>longitude,latitude arrays</em>.</p>
<p>Some complex models are truly curvilinear (i.e.&nbsp;there isn’t an underlying regular grid).</p>
<p>Much tiled imagery and web server raster data is in Mercator, but there are modes for northern and southern polar stereographic.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figure class="figure">
<img src="mercator1.png" title="AVISO surface currents" class="img-fluid figure-img">
</figure>
<p></p><figcaption aria-hidden="true" class="figure-caption">alt text</figcaption><p></p>
</figure>
</div>
<p>This is how the old AVISO ocean currents stored in NetCDF would present (this is now Copernicus and delivered well-formed NetCDF).</p>
<p>Reorient the grid, looks right, but map doesn’t line up . . .</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figure class="figure">
<img src="mercator2.png" title="AVISO surface currents - in a World Mercator" class="img-fluid figure-img">
</figure>
<p></p><figcaption aria-hidden="true" class="figure-caption">alt text</figcaption><p></p>
</figure>
</div>
<p>PROJ.4 +proj=merc +lon_0=0 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 +over +units=m +no_defs</p>
<ul>
<li>Left panel is <em>rectilinear</em>, latitude lines are denser towards the poles.</li>
<li>Right panel is <em>regular in native projection</em>, and this allows straightforward usage (and fast extraction methods).</li>
</ul>
<p>Conformal vs equal area.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figure class="figure">
<img src="Conformal.png" title="sea ice in stereographic vs laea" class="img-fluid figure-img">
</figure>
<p></p><figcaption aria-hidden="true" class="figure-caption">alt text</figcaption><p></p>
</figure>
</div>
</section>
<section id="other-map-projections-in-common-use" class="level3">
<h3 class="anchored" data-anchor-id="other-map-projections-in-common-use">Other map projections in common use</h3>
<p><b>Spherical Mercator</b> Smith/Sandwell topography-bathymetry +proj=merc +lon_0=0 +k=1 +x_0=0 +y_0=0 +a=6370997 +b=6370997 +units=m +no_defs</p>
<p><b>WGS84 Mercator</b> AVISO currents, SSH/SSHA, Sokolov/Rintoul front zones +proj=merc +lon_0=0 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 +units=m +no_defs</p>
<p><b> Equal Area Cylindrical</b> Fraser / Massom fast ice +proj=cea +lon_0=91 +lat_0=-90 +lat_ts=-65 +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 <br>+proj=cea +ellps=WGS84</p>
<p><b>Lambert Azimuthal Equal Area </b> CCAMLR management zone shapefiles +proj=laea +lat_0=-90 +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0</p>
<p><b> (North Polar) Stereographic </b> NSIDC, SSMI products, North-Hemi Snow Cover Extent +proj=stere +lat_0=90 +lat_ts=70 +lon_0=-45 +k=1 +x_0=0 +y_0=0 +a=6378273 +b=6356889.449 +units=m +no_defs <br>+proj=stere +lat_0=90 +lon_0=10 +ellps=WGS84</p>
<p><b> (South Polar) Stereographic on the sphere</b> Arrigo/Dijken primary production</p>
<p>+proj=stere +lat_0=-90 +lon_0=180 +ellps=sphere</p>
<p><b> Longitude / latitude on WGS84</b></p>
<p>+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0</p>
<p><b> Sinusoidal on WGS84 </b> SeaWiFS/MODIS Level 3 binned ocean colour</p>
<p>+proj=sinu +ellps=WGS84] = +proj=sinu +lon_0=0 +x_0=0 +y_0=0 +ellps=WGS84 +units=m +no_defs</p>
<p>Lambert Conformal Conic</p>
<pre><code>+proj=lcc +lon_0=147 +lat_0=-42 +lat_1=-50 +lat_2=-35 +datum=WGS84</code></pre>
<section id="compare-laea-with-polar-stereographic-etc" class="level4">
<h4 class="anchored" data-anchor-id="compare-laea-with-polar-stereographic-etc">Compare LAEA with Polar Stereographic etc</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raadtools)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>files <span class="ot">&lt;-</span> <span class="fu">icefiles</span>(<span class="at">hemisphere =</span> <span class="st">"south"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>dsn <span class="ot">&lt;-</span> <span class="fu">tail</span>(files<span class="sc">$</span>fullname, 1L)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="do">## compare 5e6 to 2e7</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>runfun <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">scale =</span> <span class="fl">5e6</span>) {</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  target <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">ext</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">*</span> scale, <span class="at">res =</span> <span class="dv">25000</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>world <span class="ot">&lt;-</span> geodata<span class="sc">::</span><span class="fu">world</span>(<span class="at">path =</span> <span class="fu">tempdir</span>())</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>op <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Polar stereographic (central latitude 90S, true scale 71S)</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>prj <span class="ot">&lt;-</span> <span class="st">"EPSG:3031"</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="fu">set.crs</span>(target, prj)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(stere <span class="ot">&lt;-</span> <span class="fu">project</span>(<span class="fu">rast</span>(dsn, <span class="at">lyr =</span> <span class="dv">1</span>), target), <span class="at">main =</span> <span class="st">"stere (conformal)"</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">project</span>(world, prj), <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="do">## Lambert Azimuthal Equal Area (central latitude 90S)</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>prj <span class="ot">&lt;-</span> <span class="st">"+proj=laea +lat_0=-90"</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="fu">set.crs</span>(target, prj)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(laea <span class="ot">&lt;-</span> <span class="fu">project</span>(<span class="fu">rast</span>(dsn, <span class="at">lyr =</span> <span class="dv">1</span>), target), <span class="at">main =</span> <span class="st">"laea (equal area)"</span>)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">project</span>(world, prj), <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="do">## Azimuthal Equidistant (central latitude 90S)</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>prj <span class="ot">&lt;-</span> <span class="st">"+proj=aeqd +lat_0=-90"</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="fu">set.crs</span>(target, prj)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(aeqd <span class="ot">&lt;-</span> <span class="fu">project</span>(<span class="fu">rast</span>(dsn, <span class="at">lyr =</span> <span class="dv">1</span>), target), <span class="at">main =</span> <span class="st">"aeqd (equidistant)"</span>)</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">project</span>(world, prj), <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="do">## Gnomonic (central latitude 90S)</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>prj <span class="ot">&lt;-</span> <span class="st">"+proj=gnom +lat_0=-90"</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="fu">set.crs</span>(target, prj)</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gnom <span class="ot">&lt;-</span> <span class="fu">project</span>(<span class="fu">rast</span>(dsn, <span class="at">lyr =</span> <span class="dv">1</span>), target), <span class="at">main =</span> <span class="st">"gnomonic (great circs)"</span>)</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">project</span>(world, prj), <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(op)</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="cn">NULL</span>)</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="fu">runfun</span>()</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="fu">runfun</span>(<span class="fl">2e7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figure class="figure">
<img src="fourkinds_narrow.png" title="four up close" class="img-fluid figure-img">
</figure>
<p></p><figcaption aria-hidden="true" class="figure-caption">alt text</figcaption><p></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figure class="figure">
<img src="fourproj_wide.png" title="four zoomed out" class="img-fluid figure-img">
</figure>
<p></p><figcaption aria-hidden="true" class="figure-caption">alt text</figcaption><p></p>
</figure>
</div>
</section>
</section>
</section>
<section id="demonstration-of-the-projection-concept" class="level2">
<h2 class="anchored" data-anchor-id="demonstration-of-the-projection-concept">Demonstration of the projection concept</h2>
<p>3D plots that show various projection concepts.</p>
<p>First prepared here: http://mdsumner.github.io/2016/01/26/Three_Projections.html</p>
<section id="mercator-vs-utm-the-longitude-is-the-equator" class="level4">
<h4 class="anchored" data-anchor-id="mercator-vs-utm-the-longitude-is-the-equator">Mercator vs UTM (the longitude is the equator)</h4>
<p>Different names for UTM, Map Grid of Australia, Gauss Kruger, it’s the Zone that matters - but the general case is a central longitude, and offsets for false easting,northing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>terra 1.7.18</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>zone2lon <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="sc">-</span><span class="dv">180</span> <span class="sc">+</span> (x <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">6</span> <span class="sc">+</span> <span class="dv">3</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>world <span class="ot">&lt;-</span> geodata<span class="sc">::</span><span class="fu">world</span>(<span class="at">path =</span> <span class="fu">tempdir</span>())</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>ex <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="sc">-</span>.<span class="dv">6</span>, .<span class="dv">6</span>) <span class="sc">*</span> pi <span class="sc">*</span> <span class="dv">6378137</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>merc <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">ext</span>(ex), <span class="at">res =</span> <span class="fl">1e6</span>, <span class="at">crs =</span> <span class="st">"+proj=merc +unit=km"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">cellSize</span>(merc))</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">project</span>(world, <span class="fu">crs</span>(merc)), <span class="at">add =</span> T)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">project</span>(<span class="fu">cbind</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">179</span>, <span class="dv">179</span>), <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>)), <span class="at">to =</span> <span class="st">"+proj=merc +unit=km"</span>, <span class="at">from =</span> <span class="st">"OGC:CRS84"</span>)[,<span class="dv">2</span>], <span class="at">col =</span> <span class="st">"firebrick"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2023-04-04-map-projections_files/figure-html/mercator-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>zone <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  utmproj <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"+proj=utm +zone=%s"</span>, zone)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>utm <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">ext</span>(<span class="sc">-</span>.<span class="dv">6</span>, .<span class="dv">6</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">*</span> pi <span class="sc">*</span> <span class="dv">6378137</span>, <span class="at">res =</span> <span class="fl">1e6</span>, <span class="at">crs =</span> utmproj)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>utm <span class="ot">&lt;-</span> <span class="fu">cellSize</span>(utm)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>world <span class="ot">&lt;-</span> <span class="fu">simplifyGeom</span>(world, .<span class="dv">2</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(utm)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">project</span>(world, <span class="fu">crs</span>(utm)), <span class="at">add =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Point outside of projection domain (GDAL error 1)

Warning: Point outside of projection domain (GDAL error 1)

Warning: Point outside of projection domain (GDAL error 1)

Warning: Point outside of projection domain (GDAL error 1)

Warning: Point outside of projection domain (GDAL error 1)

Warning: Point outside of projection domain (GDAL error 1)

Warning: Point outside of projection domain (GDAL error 1)

Warning: Point outside of projection domain (GDAL error 1)

Warning: Point outside of projection domain (GDAL error 1)

Warning: Point outside of projection domain (GDAL error 1)

Warning: Point outside of projection domain (GDAL error 1)

Warning: Point outside of projection domain (GDAL error 1)

Warning: Point outside of projection domain (GDAL error 1)

Warning: Point outside of projection domain (GDAL error 1)

Warning: Point outside of projection domain (GDAL error 1)

Warning: Point outside of projection domain (GDAL error 1)

Warning: Point outside of projection domain (GDAL error 1)

Warning: Point outside of projection domain (GDAL error 1)

Warning: Point outside of projection domain (GDAL error 1)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Reprojection failed, err = 2050, further errors will be suppressed on
the transform object. (GDAL error 1)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">project</span>(<span class="fu">cbind</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">zone2lon</span>(zone), <span class="dv">0</span>), <span class="at">to =</span> utmproj, <span class="at">from =</span> <span class="st">"OGC:CRS84"</span>)[,<span class="dv">1</span>], <span class="at">col =</span> <span class="st">"firebrick"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2023-04-04-map-projections_files/figure-html/mercator-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>geo <span class="ot">&lt;-</span> <span class="fu">geom</span>(world)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>xy <span class="ot">&lt;-</span> <span class="fu">project</span>(<span class="fu">cbind</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">zone2lon</span>(zone), <span class="dv">0</span>), <span class="at">to =</span> utmproj, <span class="at">from =</span> <span class="st">"OGC:CRS84"</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>utm0 <span class="ot">&lt;-</span> <span class="fu">crop</span>(utm, <span class="fu">ext</span>(<span class="fu">c</span>(<span class="fu">range</span>(xy[,<span class="dv">1</span>]), ex[<span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>])))</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>ex0 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">xmin</span>(utm0), <span class="fu">xmax</span>(utm0), <span class="fu">ymin</span>(utm0), <span class="fu">ymax</span>(utm0))</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># for (zone in 1:60) {</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   utmproj &lt;- sprintf("+proj=utm +zone=%s", zone)</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"># set.crs(utm, utmproj)</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   plot(utm)</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># #  im &lt;- whatarelief::imagery(extent = ex0, dimension = dim(utm0)[2:1] * 20, projection = utmproj)</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co"># #plot(project(world, crs(utm)), add = T)</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co"># points(project(geo[, c("x", "y")], from = "OGC:CRS84", to = utmproj), pch = ".")</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co"># abline(v = project(cbind(c(-3, 3) + zone2lon(zone), 0), to = utmproj, from = "OGC:CRS84")[,1], col = "firebrick")</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co">#  #ximage::ximage(im, ex0, add = T)</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # dev.flush()</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co"># # dev.hold()</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co"># # Sys.sleep(0.4)</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="projections" class="level2">
<h2 class="anchored" data-anchor-id="projections">Projections</h2>
<p>A brief overview here. For more please see the <a href="https://geocompr.robinlovelace.net/reproj-geo-data.html">geocompr book</a>.</p>
<p>Projections are used to solve particular measurement problems. These include <em>distance</em>, <em>area</em>, and <em>angle</em>.</p>
<ul>
<li><strong>Equal-area</strong> - area is simple, we can calculate planar area anywhere</li>
<li><strong>Equi-distant</strong> - less simple, applies along an axis or from one point only</li>
<li><strong>Conformal</strong> - preserves <em>shape</em>, i.e.&nbsp;angles are sensible</li>
</ul>
<p>No projection is perfect for every situation, and quite often tools will work in <em>geographic coordinates</em>, or raw longitude latitude values using algorithms suited for angular units on a sphere or ellipsoid.</p>
<p>Most projection specification is made by choosing an <a href="https://epsg.io/"><em>EPSG code</em></a>, and if one exists for your region then it’s a good choice. However, sometimes the right EPSG does not exist and it’s simpler to specify a custom projection.</p>
<p>Each <strong>+proj=</strong> code is a <em>projection family</em>, there are many more than shown here.</p>
<p>Lambert Azimuthal Equal Area</p>
<pre><code>+proj=laea +lon_0=0 +lat_0=-90 +datum=WGS84</code></pre>
<p>Polar Stereographic (south)</p>
<pre><code>+proj=stere +lon_0=0 +lat_0=-90 +lat_ts=-70 +datum=WGS84</code></pre>
<p>Longitude-Latitude</p>
<pre><code>+proj=longlat +datum=WGS84</code></pre>
<p>Lambert Conformal Conic</p>
<pre><code>+proj=lcc +lon_0=147 +lat_0=-42 +lat_1=-50 +lat_2=-35 +datum=WGS84</code></pre>
<p>Each of these has in common a <strong>central longitude and latitude</strong>, and many custom projections can be made using only these parameters.</p>
<p>Other parameters include</p>
<ul>
<li><strong>+x_0</strong>, <strong>+y_0</strong> - false easting (adds an arbitrary offset, usually to avoid negative coordinates)</li>
<li><strong>+lat_0</strong>, <strong>+lat_2</strong> - these are for conic projections, the <em>secant</em> latitudes</li>
<li><strong>+ellps</strong>, <strong>+no_defs</strong>, <strong>+over</strong> - various datum/ellipsoid specific</li>
<li><strong>+lat_ts</strong> - latitude of true scale projection specific, e.g.&nbsp;Stereographic</li>
<li><strong>+zone</strong>, <strong>+south</strong> - projection-specific parameters, e.g.&nbsp;for UTM</li>
</ul>
<p>Functions in R to expand EPSG parameters:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>epsg <span class="ot">&lt;-</span> <span class="dv">3412</span>   <span class="do">## south pole stereographic </span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 3409 ## south polar equal area</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 3411 ## north polar stereographic (at 45W longitude, and Hughes 1980 ellipsoid)</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 3413 ## north polar stereographic (at 45W longitude, WGS84)</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="do">## sf is easier</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_crs</span>(epsg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mapping-in-r" class="level2">
<h2 class="anchored" data-anchor-id="mapping-in-r">Mapping in R</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(maps)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Please note that rgdal will be retired during 2023,
plan transition to sf/stars/terra functions using GDAL and PROJ
at your earliest convenience.
See https://r-spatial.org/r/2022/04/12/evolution.html and https://github.com/r-spatial/evolution
rgdal: version: 1.6-5, (SVN revision 1199)
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 3.4.3, released 2022/04/22
Path to GDAL shared files: /usr/share/gdal
GDAL binary built with GEOS: TRUE 
Loaded PROJ runtime: Rel. 8.2.0, November 1st, 2021, [PJ_VERSION: 820]
Path to PROJ shared files: /perm_storage/home/mdsumner/.local/share/proj:/usr/share/proj
PROJ CDN enabled: FALSE
Linking to sp version:1.6-0
To mute warnings of possible GDAL/OSR exportToProj4() degradation,
use options("rgdal_show_exportToProj4_warnings"="none") before loading sp or rgdal.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'rgdal'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:terra':

    project</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"wrld_simpl"</span>, <span class="at">package =</span> <span class="st">"maptools"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The oldest general mapping tool in R is the <code>maps</code> package. It has a simple whole-world coastline data set for immediate use.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>maps<span class="sc">::</span><span class="fu">map</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2023-04-04-map-projections_files/figure-html/maps-package-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The data underlying this live map is available by capturing the output as an actual object.</p>
<p>If we look carefully at the southern edge and the eastern edge, notice that the coastline for Antarctica does not extend to the south pole, and the Chukotka region of Russia east of 180 longitude is not in the western part of the map.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>maps_c <span class="ot">&lt;-</span> maps<span class="sc">::</span><span class="fu">map</span>(<span class="at">plot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>lonlat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(maps_c<span class="sc">$</span>x, maps_c<span class="sc">$</span>y)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lonlat, <span class="at">pch =</span> <span class="st">"+"</span>, <span class="at">cex =</span> <span class="fl">0.4</span>, <span class="at">axes =</span> <span class="cn">FALSE</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(lonlat, <span class="at">col =</span> <span class="st">"dodgerblue"</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">90</span>, <span class="dv">90</span>), <span class="at">v =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">180</span>, <span class="dv">180</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2023-04-04-map-projections_files/figure-html/maps-assign-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>